<h1>About</h1>
<p>課程名稱: 計算機程式</p>
<p>程式操作影片：<a href="https://www.youtube.com/watch?v=UEk7Pq-pG70  課程評分:">https://www.youtube.com/watch?v=UEk7Pq-pG70</a></p>
<p>課程評分:</p>
<p style="padding-left: 30px;"><span style="background-color: #ffff00;">學習心得報告 (60%)</span> - MS Teams 線上參與，<span style="background-color: #ccffcc;">6人一組</span>每三週發表學習心得。</p>
<p style="padding-left: 60px;">w3、w7、w10、w14、w17、w18</p>
<p style="padding-left: 60px;">學習心得報告主題:</p>
<p style="padding-left: 60px;">w3: 什麼是 git, GitHub, gist 與 cmsimde? 如何使用這些工具？為什麼要使用這些工具？ (<a href="https://mde.tw/cp2025/content/Brython.html?src=https://gist.githubusercontent.com/mdecycu/71ff1c69dd233e6a5a83dd60997950de/raw/b4134dc3724f9c6aa1de7534a74f298288de0fa5/round_dot_move.py">動態模擬</a>)</p>
<p style="padding-left: 60px;">w7: Brython 是什麼？如何在瀏覽器配置 Brython 環境？ Brython 能做什麼？ (<a href="https://mde.tw/cp2025/content/Brython.html">Brython</a>, <a href="https://mde.tw/cp2025/content/Robot_ex.html">Examples</a>)</p>
<p style="padding-left: 60px;">w10: 如何在瀏覽器中模擬機器人作動？ (<a href="https://mde.tw/cp2025/content/Brython.html?src=https://gist.githubusercontent.com/mdecycu/58fed8bd2f5be98a6456a8dcae512011/raw/4019adba4ee4be19c35982d835bad8e7d83a7b2f/brython_robot4_ex1.py">機器人作動</a>)</p>
<p style="padding-left: 60px;">w14: 在瀏覽器中模擬機器人作動的目的是什麼？ (<a href="/downloads/otto_robot.7z">otto_robot.7z</a>, <a href="https://mde.tw/cad2025/content/Homework.html">Plotter</a>, <a href="/downloads/open_duck_mini.7z">open_duck_mini.7z</a> ,<a href="https://webots.cloud/AcTNYs0">https://webots.cloud/AcTNYs0</a>)</p>
<p style="padding-left: 60px;">w17 (<span style="background-color: #ccffcc;">1b 採 Youtube 影片簡報</span>): 計算機程式課程學到了什麼？</p>
<p style="padding-left: 60px;">w18: 課程總結</p>
<p style="padding-left: 30px;"><span style="background-color: #ffff00;">個人與分組網站維護 (40%)</span> - 每週至少兩次推送與課程進度相關的學習內容與心得。</p>
<p style="padding-left: 60px;">w9 期中自評、w18 期末自評</p><h1>學習心得報告</h1>
<h2>W10</h2>
<p><strong>如何在瀏覽器中模擬機器人作動？</strong></p>
<p><strong>模擬物理機器人動作</strong></p>
<p data-end="183" data-start="139">如果目標是「機器人動作模擬」，瀏覽器環境主要是做<strong data-end="176" data-start="163">三維或二維動畫模擬</strong>，常用工具有：</p>
<ul data-end="529" data-start="185">
<li data-end="357" data-start="185">
<p data-end="238" data-start="187"><strong data-end="207" data-start="187">Three.js + WebGL</strong><br data-end="210" data-start="207"/>可用於在瀏覽器中建模機器人關節、骨架和運動軌跡。</p>
<ul data-end="357" data-start="241">
<li data-end="284" data-start="241">
<p data-end="284" data-start="243">可以用<span> </span><code data-end="269" data-start="247">THREE.SkeletonHelper</code><span> </span>來模擬機器人的骨架運動。</p>
</li>
<li data-end="336" data-start="287">
<p data-end="336" data-start="289">配合動畫或物理引擎（如<span> </span><code data-end="312" data-start="301">Cannon.js</code><span> </span>或<span> </span><code data-end="324" data-start="315">Ammo.js</code>）可以模擬力學反應。</p>
</li>
<li data-end="357" data-start="339">
<p data-end="357" data-start="341">適合教學、視覺化、原型設計。</p>
</li>
</ul>
</li>
<li data-end="422" data-start="359">
<p data-end="422" data-start="361"><strong data-end="395" data-start="361">Blockly / Scratch + JavaScript</strong><br data-end="398" data-start="395"/>可做簡單的關節控制模擬，用於教育或概念驗證。</p>
</li>
<li data-end="529" data-start="424">
<p data-end="529" data-start="426"><strong data-end="454" data-start="426">Gazebo / ROS + WebSocket</strong><br data-end="457" data-start="454"/>如果你要真實的控制機器人模型，可以把 ROS 模擬環境（Gazebo）和瀏覽器連接，用 WebSocket 控制機器人，瀏覽器顯示動畫。</p>
</li>
</ul>
<p><strong data-end="539" data-start="531">實務思路</strong><span>：</span></p><h2>W7</h2>
<p><strong>Brython 是什麼</strong></p>
<p><strong>全名</strong>： Browser Python</p>
<p><strong data-end="202" data-start="196">目標</strong>：讓 Python 直接在瀏覽器執行，取代 JavaScript 來操作前端。</p>
<p><strong data-end="252" data-start="246">特點</strong>：</p>
<p>完整支援 Python 3 語法（大部分標準庫，但不包含操作系統、檔案 I/O 等 Node.js 專用功能）</p>
<p>可以直接操控 HTML DOM、CSS、事件，像用 JS 一樣</p>
<p>適合快速原型、教學、互動程式</p>
<p><strong>在瀏覽器配置 Brython 環境</strong></p>
<p data-end="421" data-start="406">其實非常簡單，基本上只要三步：</p>
<p><strong>(1) 引入 Brython</strong></p>
<p data-end="461" data-start="442">在 HTML加上：</p>
<div>
<div class="syntaxhighlighter html" id="highlighter_747157">
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">1
&lt;script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython.min.js"&gt;&lt;/script&gt;</pre>
<p data-end="461" data-start="442"><strong>(2) 編寫 Python 腳本</strong></p>
<div>
<div class="syntaxhighlighter html" id="highlighter_909775">
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">&lt;script type="text/python"&gt;
from browser import document, html
 
def say_hello(event):
    document["output"].text = "Hello, Brython!"
 
document["myButton"].bind("click", say_hello)
&lt;/script&gt;
</pre>
</div>
</div>
<p data-end="461" data-start="442">這裡<span> </span><code data-end="830" data-start="808">document["myButton"]</code><span> </span>就是對應 HTML 按鈕元素。</p>
<p data-end="461" data-start="442"><strong>(3) 啟動 Brython</strong></p>
<div>
<div class="syntaxhighlighter html" id="highlighter_721139"></div>
<div class="syntaxhighlighter html">
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">&lt;body onload="brython()"&gt;
    &lt;button id="myButton"&gt;點我&lt;/button&gt;
    &lt;div id="output"&gt;&lt;/div&gt;
&lt;/body&gt;</pre>
</div>
</div>
<p><strong>Brython 能做什麼</strong></p>
<ol data-end="1322" data-start="1028">
<li data-end="1076" data-start="1028">
<p data-end="1056" data-start="1031"><strong data-end="1054" data-start="1031">操作 DOM / HTML / CSS</strong></p>
<p data-end="1076" data-start="1062">動態修改內容、樣式、顯示動畫</p>
</li>
<li data-end="1109" data-start="1077">
<p data-end="1090" data-start="1080"><strong data-end="1088" data-start="1080">事件處理</strong></p>
<p data-end="1109" data-start="1096">點擊、滑鼠、鍵盤、拖曳事件</p>
</li>
<li data-end="1181" data-start="1110">
<p data-end="1124" data-start="1113"><strong data-end="1122" data-start="1113">繪圖和動畫</strong></p>
<p data-end="1181" data-start="1130">搭配<span> </span><code data-end="1143" data-start="1133">&lt;canvas&gt;</code><span> </span>或<span> </span><code data-end="1167" data-start="1146">browser.html.CANVAS</code><span> </span>做 2D/簡單 3D 動畫</p>
</li>
<li data-end="1218" data-start="1182">
<p data-end="1197" data-start="1185"><strong data-end="1195" data-start="1185">簡單網路請求</strong></p>
<p data-end="1218" data-start="1203">AJAX / fetch 請求</p>
</li>
<li data-end="1270" data-start="1219">
<p data-end="1236" data-start="1222"><strong data-end="1234" data-start="1222">算法、邏輯、模擬</strong></p>
<p data-end="1270" data-start="1242">像物理模擬、運動學計算、數據處理，都可以在瀏覽器直接執行</p>
</li>
<li data-end="1322" data-start="1271">
<p data-end="1287" data-start="1274"><strong data-end="1285" data-start="1274">教育、原型驗證</strong></p>
<p data-end="1322" data-start="1293">適合在網頁上做互動式教學或快速原型，不必安裝 Python</p>
</li>
</ol>
</div>
</div><h2>W3</h2>
<p><strong>什麼是 git?</strong></p>
<p>Git 是「版本控制系統（Version Control System, VCS）」，專門用來管理程式碼或任何文件的變化歷史。</p>
<p>它能記錄每一次修改，讓你隨時回到過去的版本，並且支援多人協作，不會互相覆蓋對方的修改。</p>
<p>以下是使用方法</p>
<p># 初始化一個 Git 倉庫<br/>git init</p>
<p># 查看檔案狀態<br/>git status</p>
<p># 新增檔案到暫存區<br/>git add filename</p>
<p># 提交修改<br/>git commit -m "說明文字"</p>
<p># 查看提交歷史<br/>git log</p>
<p><strong>為什麼要用</strong></p>
<p>避免丟失程式碼或文件。</p>
<p>可以追蹤每個修改的原因和作者。</p>
<p>支援多人協作，能解決衝突（merge conflict）</p>
<p><strong>什麼是GitHub?</strong></p>
<p>GitHub 是「線上 Git 倉庫服務平台」，可以把你的 Git 倉庫放到雲端。</p>
<p><strong>使用方法</strong></p>
<p># 把本地 Git 倉庫連接到 GitHub<br/>git remote add origin https://github.com/username/repo.git</p>
<p># 推送本地修改到 GitHub<br/>git push origin main</p>
<p>#從 GitHub 抓取最新版本<br/>git pull origin main</p>
<p><strong>為什麼要用</strong></p>
<p>雲端備份，不怕本地電腦壞掉。</p>
<p>開源分享，方便協作和學習。</p>
<p>提供社群和專案管理功能（issue、wiki、action）。</p>
<p><strong>什麼是Gist?</strong></p>
<p data-end="985" data-start="940">Gist 是 GitHub 提供的「單檔或小程式碼片段分享服務」。</p>
<p data-end="985" data-start="940">可以是單一檔案，也可以是多個檔案。</p>
<p data-end="985" data-start="940">支援 public（公開）和 secret（秘密但可連結訪問）模式。</p>
<p data-end="985" data-start="940"><strong data-end="1057" data-start="1048">使用方法</strong></p>
<p data-end="1059" data-start="1048">到<span> </span><a class="decorated-link" data-end="1107" data-start="1065" href="https://gist.github.com/" rel="noopener" target="_new">gist.github.com</a>新增檔案。</p>
<p data-end="1059" data-start="1048">填入程式碼 → 提交 → 生成連結分享。</p>
<p data-end="1059" data-start="1048">也可以用 Git 指令管理（因為 Gist 也是 Git 倉庫）</p>
<p data-end="1059" data-start="1048"><strong>為什麼要用</strong></p>
<p data-end="1059" data-start="1048">分享小程式碼片段比整個 GitHub repo 更輕便。</p>
<p data-end="1059" data-start="1048">適合快速記錄實驗、範例或解題程式碼。</p>
<p data-end="1059" data-start="1048"><strong>什麼是 CMSimde？</strong></p>
<p data-end="1059" data-start="1048">CMSimde 是基於 Python、HTML、CSS、JavaScript 等 Web 技術的一套內容管理系統（CMS）。CMS 這種系統的主要目的，是讓使用者能夠在瀏覽器上編輯和維護一個網站的內容，而不需要每次都直接改 HTML 原始檔。</p>
<p data-end="1059" data-start="1048"><strong data-end="1057" data-start="1048">使用方法</strong></p>
<ul>
<li data-end="756" data-start="662">
<p data-end="756" data-start="665">設定 Python 環境<br data-end="684" data-start="681"/>安裝 Python 或 miniconda，建立專用的虛擬環境。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill"></span></span></p>
</li>
<li data-end="957" data-start="758">
<p data-end="822" data-start="761">安裝相依套件<br data-end="774" data-start="771"/>利用<span> </span><code data-end="795" data-start="780">conda install</code><span> </span>或<span> </span><code data-end="811" data-start="798">pip install</code><span> </span>安裝必要套件，例如：</p>
<p data-end="822" data-start="761"><span class="hljs-attribute">flask</span><span> </span>flask_cors bs4 lxml pelican markdown gevent</p>
<p data-end="957" data-start="895">這些是 CMSimde 需要的後端與內容處理工具。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill"></span></span></p>
</li>
<li data-end="1069" data-start="959">
<p data-end="1069" data-start="962">啟動 CMSimde<br data-end="979" data-start="976"/>進入專案資料夾，執行像<span> </span><code data-end="999" data-start="994">cms</code><span> </span>或<span> </span><code data-end="1018" data-start="1002">python wsgi.py</code><span> </span>這類指令以啟動網站伺服器。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill"></span></span></p>
</li>
<li data-end="1131" data-start="1071">
<p data-end="1131" data-start="1074">透過瀏覽器管理內容<br data-end="1090" data-start="1087"/>在瀏覽器中打開特定的網址，你就可以新增頁面、修改內容、管理分類、上傳檔案等。</p>
</li>
<li data-end="1261" data-start="1133">
<p data-end="1261" data-start="1136">與 Git/GitHub 結合（可選）<br data-end="1162" data-start="1159"/>將這些網站內容放進 Git 倉庫，在本地編輯後推送到 GitHub，再利用 GitHub Pages 或其他服務部署。</p>
<strong>為什麼要用 CMSimde?</strong></li>
<li data-end="1261" data-start="1133">CMSimte 幫你把網站內容抽象化，不用每次手寫 HTML、CSS、JavaScript，你只要在 Web 上編輯內容，就能管理網頁。</li>
<li data-end="1261" data-start="1133"><strong data-end="1462" data-start="1446">與 Git が配合</strong><br data-end="1465" data-start="1462"/>你可以把整個網站專案放到 Git（無論是 GitHub、GitLab）上做版本控制。每次內容修改不但有時光機能，也能多人協作。</li>
<li data-end="1261" data-start="1133"><strong data-end="1584" data-start="1567">學習網頁後端開發技術</strong><br data-end="1587" data-start="1584"/>CMSimde 實際上是 Python + Flask + 前端技術的整合體，你能從它裡面看到動態網站的構建流程，這對將來做 Web 開發很有幫助。</li>
<li data-end="1261" data-start="1133"><strong data-end="1721" data-start="1702">自訂性高 / 可編輯源碼</strong><br data-end="1724" data-start="1721"/>這系統是開源的（BSD 授權），如果你有需求，可以自己修改後端行為或前端介面。</li>
<li data-end="1261" data-start="1133"><strong data-end="1336" data-start="1319">提高網站內容管理效率</strong><br data-end="1339" data-start="1336"/>CMSimte 幫你把網站內容抽象化，不用每次手寫 HTML、CSS、JavaScript，你只要在 Web 上編輯內容，就能管理網頁。</li>
</ul><h1>Brython</h1>
<p><a href="https://brython.info/">Brython</a> 是一個將 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 語法編譯為 <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript">JavaScript</a> 的工具，能直接在瀏覽器中以 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 撰寫前端網頁程式。</p>
<p><button id="add1to100">1 add to 100</button><button id="robot1">機器人巡邏</button><button id="free_walk">自由行</button></p>
<!-- 導入 brython 程式庫 -->
<p>
<script src="/static/brython.js"></script>
<script src="/static/brython_stdlib.js"></script>
</p>
<!-- 啟動 Brython -->
<p>
<script>
window.onload=function(){
brython({debug:1, pythonpath:['/static/','./../downloads/py/']});
}
</script>
</p>
<p><!-- 導入 FileSaver 與 filereader --></p>
<p>
<script src="/static/ace/FileSaver.min.js" type="text/javascript"></script>
<script src="/static/ace/filereader.js" type="text/javascript"></script>
</p>
<p><!-- 導入 ace --></p>
<p>
<script src="/static/ace/ace.js" type="text/javascript"></script>
<script src="/static/ace/ext-language_tools.js" type="text/javascript"></script>
<script src="/static/ace/mode-python3.js" type="text/javascript"></script>
<script src="/static/ace/snippets/python.js" type="text/javascript"></script>
</p>
<p><!-- 導入 gearUtils-0.9.js Cango 齒輪繪圖程式庫 -->
<script src="/static/Cango-24v03-min.js"></script>
<script src="/static/gearUtils-09.js"></script>
<script src="/static/SVGpathUtils-6v03-min.js"></script>
<script src="/static/sylvester.js"></script>
<script src="/static/PrairieDraw.js"></script>
</p>
<p><!-- 請注意, 這裡使用 Javascript 將 localStorage["kw_py_src1"] 中存在近端瀏覽器的程式碼, 由使用者決定存檔名稱--></p>
<p>
<script type="text/javascript">
function doSave(storage_id, filename){
    var blob = new Blob([localStorage[storage_id]], {type: "text/plain;charset=utf-8"});
    filename = document.getElementById(filename).value
    saveAs(blob, filename+".py");
}
</script>
</p>
<p><!-- 累加程式開始 -->
<script type="text/python3">
from browser import document as doc
import ace
# 清除畫布
def clear_bd1(ev):
    bd = doc["brython_div1"]
    bd.clear()
Ace1 = ace.Editor(editor_id="kw_editor1", console_id="kw_console1", container_id="kw__container1", storage_id="kw_py_src1" )
# 從 gist 取出程式碼後, 放入 editor 作為 default 程式
def run1():
    # 利用 get 取下 src 變數值
    try:
        url = doc.query["src"]
    except:
        url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c3a6deaf717f8f2739a4b1392a5ab10936e9693a/from_1_add_to_10_1.py"
    prog = open(url).read()

    # 將程式載入編輯區
    Ace1.editor.setValue(prog)
    Ace1.editor.scrollToRow(0)
    Ace1.editor.gotoLine(0)
    # 直接執行程式
    #ns = {'__name__':'__main__'}
    #exec(prog, ns)
    # 按下 run 按鈕
    Ace1.run()
# 執行程式, 顯示輸出結果與清除輸出結果及對應按鈕綁定
doc['kw_run1'].bind('click', Ace1.run)
doc['kw_show_console1'].bind('click', Ace1.show_console)
doc['kw_clear_console1'].bind('click', Ace1.clear_console)
doc['clear_bd1'].bind('click', clear_bd1)
# 呼叫函式執行
run1()
</script>
<!-- 累加程式結束 --> <!-- 機器人巡邏程式開始 -->
<script type="text/python3">
from browser import document as doc
import ace

# 清除畫布
def clear_bd1(ev):
    bd = doc["brython_div1"]
    bd.clear()

# 利用 ace 中的 Editor 建立 Ace2 物件, 其中的輸入變數分別對應到頁面中的編輯區物件
Ace2 = ace.Editor(editor_id="kw_editor1", console_id="kw_console1", container_id="kw__container1", storage_id="kw_py_src1" )

robot1_url = "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/b33c5fc2a0774f8c5d2b0e8c7c7908e58d73bb94/robot_1.py"

# 從 gist 取得程式碼
robot1_src = open(robot1_url).read()
def robot1(ev):
    Ace2.editor.setValue(robot1_src)
    Ace2.editor.scrollToRow(0)
    Ace2.editor.gotoLine(0)
    Ace2.run()

# id 為 "robot1" 的按鈕點按時, 執行 robot1 方法
doc["robot1"].bind('click', robot1)
</script>
<!-- 機器人巡邏程式結束 --></p>
<!-- 機器人自由行程式開始 -->
<p>
<script type="text/python3">
from browser import document as doc
import ace

# 清除畫布
def clear_bd1(ev):
    bd = doc["brython_div1"]
    bd.clear()

# 利用 ace 中的 Editor 建立 Ace2 物件, 其中的輸入變數分別對應到頁面中的編輯區物件
Ace2 = ace.Editor(editor_id="kw_editor1", console_id="kw_console1", container_id="kw__container1", storage_id="kw_py_src1" )

free_walk_url = "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9d55811467e411eb89f74171d8a586ae9f1a96aa/brython_robot_free_walk.py"

# 從 gist 取得程式碼
free_walk_src = open(free_walk_url).read()
def free_walk(ev):
    Ace2.editor.setValue(free_walk_src)
    Ace2.editor.scrollToRow(0)
    Ace2.editor.gotoLine(0)
    Ace2.run()

# id 為 "free_walk" 的按鈕點按時, 執行 robot1 方法
doc["free_walk"].bind('click', free_walk)
</script>
</p>
<!-- 機器人自由行程式結束 -->
<p><!-- add 1 to 100 開始 -->
<script type="text/python3">
from browser import document as doc
import ace

# 清除畫布
def clear_bd1(ev):
    bd = doc["brython_div1"]
    bd.clear()

# 利用 ace 中的 Editor 建立 Ace2 物件, 其中的輸入變數分別對應到頁面中的編輯區物件
Ace2 = ace.Editor(editor_id="kw_editor1", console_id="kw_console1", container_id="kw__container1", storage_id="kw_py_src1" )

add1to100_url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py"

# 從 gist 取得程式碼
add_src = open(add1to100_url).read()
def add(ev):
    Ace2.editor.setValue(add_src)
    Ace2.editor.scrollToRow(0)
    Ace2.editor.gotoLine(0)
    Ace2.run()

# id 為 "add1to100" 的按鈕點按時, 執行 add 方法
doc["add1to100"].bind('click', add)
</script>
</p>
<p><!-- add 1 to 100 結束--></p>
<!-- editor1 開始 -->
<p><!-- 用來顯示程式碼的 editor 區域 --></p>
<div id="kw_editor1" style="width: 600px; height: 300px;"></div>
<p><!-- 以下的表單與按鈕與前面的 Javascript doSave 函式以及 FileSaver.min.js 互相配合 --></p>
<p><!-- 存擋表單開始 --></p>
<form><label>Filename: <input id="kw_filename" placeholder="input file name" type="text"/>.py</label> <input onclick="doSave('kw_py_src1', 'kw_filename1');" type="submit" value="Save"/></form>
<p><!-- 存擋表單結束 --></p>
<p></p>
<p><!-- 執行與清除按鈕開始 --></p>
<p><button id="kw_run1">Run</button> <button id="kw_show_console1">Output</button> <button id="kw_clear_console1">清除輸出區</button><button id="clear_bd1">清除繪圖區</button><button onclick="window.location.reload()">Reload</button></p>
<p><!-- 執行與清除按鈕結束 --></p>
<p></p>
<p><!-- 程式執行 ouput 區 --></p>
<div style="width: 100%; height: 100%;"><textarea autocomplete="off" id="kw_console1"></textarea></div>
<p><!-- Brython 程式執行的結果, 都以 brython_div1 作為切入位置 --></p>
<div id="brython_div1"></div>
<!-- editor1 結束 --><hr/><!-- ########################################## -->
<p>從 1 累加到 100 part2:</p>
<p><button id="add1to100part2">1 add to 100</button><button id="cango_three_gears">cango_three_gears</button><button id="bsnake">BSnake</button><button id="aitetris">AI Tetris</button></p>
<p><!-- 請注意, 這裡使用 Javascript 將 localStorage["kw_py_src2"] 中存在近端瀏覽器的程式碼, 由使用者決定存檔名稱--></p>
<p>
<script type="text/python3">
from browser import document as doc
import ace
# 清除畫布
def clear_bd2(ev):
    bd = doc["brython_div2"]
    bd.clear()
Ace3 = ace.Editor(editor_id="kw_editor2", console_id="kw_console2", container_id="kw__container2", storage_id="kw_py_src2" )
# 從 gist 取出程式碼後, 放入 editor 作為 default 程式
def run2():
    # 利用 get 取下 src 變數值
    try:
        url = doc.query["src2"]
    except:
        url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c3a6deaf717f8f2739a4b1392a5ab10936e9693a/from_1_add_to_10_1.py"
    prog = open(url).read()

    # 將程式載入編輯區
    Ace3.editor.setValue(prog)
    Ace3.editor.scrollToRow(0)
    Ace3.editor.gotoLine(0)
    # 直接執行程式
    #ns = {'__name__':'__main__'}
    #exec(prog, ns)
    # 按下 run 按鈕
    Ace3.run()

# 執行程式, 顯示輸出結果與清除輸出結果及對應按鈕綁定
doc['kw_run2'].bind('click', Ace3.run)
doc['kw_show_console2'].bind('click', Ace3.show_console)
doc['kw_clear_console2'].bind('click', Ace3.clear_console)
doc['clear_bd2'].bind('click', clear_bd2)
# 呼叫函式執行
run2()
</script>
</p>
<p><!-- add 1 to 100 part2 開始 -->
<script type="text/python3">
from browser import document as doc
import ace

# 清除畫布
def clear_bd2(ev):
    bd = doc["brython_div2"]
    bd.clear()

# 利用 ace 中的 Editor 建立 Ace2 物件, 其中的輸入變數分別對應到頁面中的編輯區物件
Ace4 = ace.Editor(editor_id="kw_editor2", console_id="kw_console2", container_id="kw__container2", storage_id="kw_py_src2" )

# 透過 Ace4 以類別建立一個通用的 button2, 可以在多個案例中將 gist 程導入編輯區

class button2:
    def __init__(self, url):
        self.url = url

    # 記得加入 event 輸入變數
    def do(self,ev):
        Ace4.editor.setValue(open(self.url).read())
        Ace4.editor.scrollToRow(0)
        Ace4.editor.gotoLine(0)
        Ace4.run()

add1to100_url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py"

# 從 gist 取得程式碼
add_src = open(add1to100_url).read()
def add2(ev):
    Ace4.editor.setValue(add_src)
    Ace4.editor.scrollToRow(0)
    Ace4.editor.gotoLine(0)
    Ace4.run()

# id 為 "add1to100part2" 的按鈕點按時, 執行 add 方法
doc["add1to100part2"].bind('click', add2)
# 以下為運用 button2 class 的通用 gist 程式導入區
################################## cango_three_gears start
cango_three_gears_url = "https://gist.githubusercontent.com/mdecycu/d9082d678096bd58378d6afe2c7fa05d/raw/f7a85d737d6723d5e34c526d5daee990ed92c32b/cango_three_gears_brython_div2.py"
cango_three_gears = button2(cango_three_gears_url)
doc["cango_three_gears"].bind("click", cango_three_gears.do)
################################## cango_three_gears end
################################## bsnake start
bsnake_url = "https://gist.githubusercontent.com/mdecycu/d9082d678096bd58378d6afe2c7fa05d/raw/f7a85d737d6723d5e34c526d5daee990ed92c32b/kmol_snakey.py"
bsnake = button2(bsnake_url)
doc["bsnake"].bind("click", bsnake.do)
################################## bsnake end
################################## aitetris start
aitetris_url = "https://gist.githubusercontent.com/mdecycu/d9082d678096bd58378d6afe2c7fa05d/raw/f7a85d737d6723d5e34c526d5daee990ed92c32b/pygame_to_brython_tetris_ai.py"
aitetris = button2(aitetris_url)
doc["aitetris"].bind("click", aitetris.do)
################################## aitetris end
</script>
</p>
<p><!-- add 1 to 100 part2 結束--></p>
<!-- editor2 開始 -->
<p><!-- 用來顯示程式碼的 editor 區域 --></p>
<div id="kw_editor2" style="width: 600px; height: 300px;"></div>
<p><!-- 以下的表單與按鈕與前面的 Javascript doSave 函式以及 FileSaver.min.js 互相配合 --></p>
<p><!-- 存擋表單開始 --></p>
<form><label>Filename: <input id="kw_filename2" placeholder="input file name" type="text"/>.py</label> <input onclick="doSave('kw_py_src2', 'kw_filename2');" type="submit" value="Save"/></form>
<p><!-- 存擋表單結束 --></p>
<p></p>
<p><!-- 執行與清除按鈕開始 --></p>
<p><button id="kw_run2">Run</button> <button id="kw_show_console2">Output</button> <button id="kw_clear_console2">清除輸出區</button><button id="clear_bd2">清除繪圖區</button><button onclick="window.location.reload()">Reload</button></p>
<p><!-- 執行與清除按鈕結束 --></p>
<p></p>
<p><!-- 程式執行 ouput 區 --></p>
<div style="width: 100%; height: 100%;"><textarea autocomplete="off" id="kw_console2"></textarea></div>
<p><!-- Brython 程式執行的結果, 都以 brython_div1 作為切入位置 --></p>
<div id="brython_div2"></div>
<!-- editor2 結束 --><hr/>
<p></p>
<h2>Pyodide3</h2>
<p>Pyodide3 則在 <a href="https://mde.tw/cp2025/content/Pyodide.html">Pyodide</a> 與 <a href="https://mde.tw/cp2025/content/Pyodide2.html">Pyodide2</a> 頁面架構下，進一步導入 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a>，在既有的水平圍牆 <a href="https://mde.tw/cp2025/reeborg/src/images/north.png">north.png</a> 與垂直圍牆 <a href="https://mde.tw/cp2025/reeborg/src/images/east.png">east.png</a> 檔案之外，加入 <a href="https://mde.tw/cp2025/reeborg/src/images/carrot.png">carrot.png</a>、<a href="https://mde.tw/cp2025/reeborg/src/images/grass.png">grass.png</a> 與 <a href="https://mde.tw/cp2025/reeborg/src/images/pale_grass.png">pale_grass.png</a> 等圖檔。並且擴充可從 URL 讀進 json 格式的 world 變數功能，以便製作出更多元的場景任務，要求機器人執行。</p>
<p>其中 src URL 變數，可以將網路上的機器人控制程式導入 Pyodide3 頁面外，world URL 變數則可以導入源自 <a href="https://mde.tw/reeborg">Reeborg</a> 機器人程式所設定的 json 格式場景。</p>
<p>由於 Reeborg 系統中的 png 圖檔均非透明背景，<a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a> 必須利用 HTML 中的 CANVAS，將關鍵的白色背景，以透明的方式顯示。</p>
<p>src URL 變數讀進 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py">turn_right 程式</a>，而 world URL 變數則讀進 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/43517f3f54a5ac24d55d5a5cf8d316e6db2f3b65/harvest2.json">harvest2.json</a>，執行<a href="https://mde.tw/cp2025/content/Pyodide3.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py&amp;world=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/43517f3f54a5ac24d55d5a5cf8d316e6db2f3b65/harvest2.json">結果</a>。</p>
<p>讀進 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/1b1c26eca7f5d772c6301bae865efaddb00a87bb/harvest3.json">harvest3.json</a>, 執行<a href="https://mde.tw/cp2025/content/Pyodide3.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py&amp;world=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/harvest3.json">結果</a>。</p>
<p>
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js"></script>
</p>
<p><button id="version">version</button> <button id="hello_button">hello</button> <button id="add1to100">1 add to 100</button> <button id="robot1">機器人巡邏</button> <button id="free_walk">自由行</button> <button id="numpy_ode">numpy_ode</button></p>
<!-- Ace Editor Scripts -->
<p>
<script src="/static/ace/FileSaver.min.js"></script>
<script src="/static/ace/filereader.js"></script>
<script src="/static/ace/ace.js"></script>
<script src="/static/ace/ext-language_tools.js"></script>
<script src="/static/ace/mode-python.js"></script>
<script src="/static/ace/snippets/python.js"></script>
</p>
<!-- Editor 1 -->
<div id="kw_editor1" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run1">Run</button> <button id="kw_output1">Output</button> <button id="kw_clear_console1">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console1"></textarea></p>
<div id="pyodide_div1"></div>
<div id="mpl_output1"></div>
<div id="brython_div1"></div>
<hr/>
<p>從 1 累加到 100 part2:</p>
<p><button id="add1to100part2">1 add to 100</button></p>
<!-- Editor 2 -->
<div id="kw_editor2" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run2">Run</button> <button id="kw_output2">Output</button> <button id="kw_clear_console2">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console2"></textarea></p>
<div id="pyodide_div2"></div>
<div id="mpl_output2"></div>
<div id="brython_div2"></div>
<p>
<script>
function getUrlParam(key) {
  return new URLSearchParams(window.location.search).get(key);
}
function updateUrlParam(key, value) {
  const url = new URL(window.location);
  url.searchParams.set(key, value);
  window.history.replaceState({}, "", url);
}

let pyodide, editor1, editor2;

// 新增：把 robot_w_world.py 寫入 pyodide FS
async function loadRobotModule() {
  const robotUrl = "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py";
  const r = await fetch(robotUrl);
  if (!r.ok) throw new Error(`載入 robot.py 失敗: ${r.status}`);
  const code = await r.text();
  pyodide.FS.writeFile("/robot.py", code);
  pyodide.runPython(`import sys; sys.path.append("/")`);  // 加入根目錄到 sys.path
}

document.addEventListener("DOMContentLoaded", async () => {
  editor1 = ace.edit("kw_editor1");
  editor1.setTheme("ace/theme/chrome");
  editor1.session.setMode("ace/mode/python");

  editor2 = ace.edit("kw_editor2");
  editor2.setTheme("ace/theme/chrome");
  editor2.session.setMode("ace/mode/python");

  pyodide = await loadPyodide();
  await pyodide.loadPackage(["numpy", "scipy", "matplotlib", "micropip"]);

  // 預先載入 robot.py
  await loadRobotModule();

  // 你現有的 hello() 定義
  const code = `
def hello():
    print("Hello from custom module!")
`;
  pyodide.runPython(code);

  // 這是你之前其他按鈕用的 Gist 連結
  const GIST_ADD1TO100 =
    "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/" +
    "c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py";
  const NUMPY_ODE =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "98d582539545b3c9fbfa35dd3e605c506367618e/pyodide_ode_ex1.py";
  const PYODIDE_ROBOT_ANIMATION =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "ff833d14181c7e270d37432aa8589f5ecf00e383/pyodide_walk_around2.py";
  const FREE_WALK = 
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" + "2a66dceb4a1dbdd0c384d4d17453f1e4f03f2493/pyodide_free_walk2.py"

  // 預設載入 GIST_ADD1TO100（或 URL 參數決定）
  const src = getUrlParam("src");
  if (src === PYODIDE_ROBOT_ANIMATION) {
    const robotCode = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(robotCode, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  } else {
    const initialCode = await fetchCode(src || GIST_ADD1TO100);
    editor1.setValue(initialCode, -1);
    runPyodide(editor1, "kw_console1", "brython_div1");
  }

  editor2.setValue("", -1);

  // 按鈕事件
  document.getElementById("version").onclick = () => {
    const vcode = `
import pyodide
import sys
import matplotlib
import numpy
import scipy
print("Pyodide version:", pyodide.__version__)
print("Python version :", sys.version)
print("matplotlib version:", matplotlib.__version__)
print("numpy version:", numpy.__version__)
print("scipy version:", scipy.__version__)
`;
    editor1.setValue(vcode, -1);
    updateUrlParam("src", "inline_version");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("hello_button").onclick = () => {
    editor1.setValue("hello()", -1);
    updateUrlParam("src", "inline_hello");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor1.setValue(c, -1);
    updateUrlParam("src", GIST_ADD1TO100);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("numpy_ode").onclick = async () => {
    const c = await fetchCode(NUMPY_ODE);
    editor1.setValue(c, -1);
    updateUrlParam("src", NUMPY_ODE);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("robot1").onclick = async () => {
    const rc = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(rc, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("free_walk").onclick = async () => {
    const rc = await fetchCode(FREE_WALK);
    editor1.setValue(rc, -1);
    updateUrlParam("src", FREE_WALK);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100part2").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor2.setValue(c, -1);
    runPyodide(editor2, "kw_console2", "brython_div2");
  };

  document.getElementById("kw_run1").onclick = () =>
    runPyodide(editor1, "kw_console1", "brython_div1");
  document.getElementById("kw_run2").onclick = () =>
    runPyodide(editor2, "kw_console2", "brython_div2");
  document.getElementById("kw_clear_console1").onclick = () =>
    clearOutput("kw_console1", "brython_div1");
  document.getElementById("kw_clear_console2").onclick = () =>
    clearOutput("kw_console2", "brython_div2");
});

// 調整 output textarea 行數
document.getElementById("kw_output1").onclick = () => {
  const ta = document.getElementById("kw_console1");
  ta.rows = "15";
  ta.cols = "70";
  ta.scrollTop = 0;
};
document.getElementById("kw_output2").onclick = () => {
  const ta = document.getElementById("kw_console2");
  ta.rows = "15";
  ta.cols = "70";
  ta.scrollTop = 0;
};

async function fetchCode(url) {
  const r = await fetch(url);
  if (!r.ok) throw new Error(`載入失敗 ${r.status}`);
  return await r.text();
}

function clearOutput(consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";
}

async function runPyodide(editor, consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";

  await pyodide.runPythonAsync(`
import sys
class JsWriter:
  def write(self, s):
    from js import document
    ta = document.getElementById("${consoleId}")
    ta.value += s
    ta.scrollTop = ta.scrollHeight
sys.stdout = JsWriter()
sys.stderr = JsWriter()
`);

  try {
    await pyodide.runPythonAsync(editor.getValue());
  } catch (e) {
    document.getElementById(consoleId).value += "\\n錯誤：" + e.toString();
  }
}
</script>
</p>